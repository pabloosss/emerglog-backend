<script>
document.getElementById("generatePDF").addEventListener("click", async () => {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();

    if (!name || !email) {
        alert("❌ Podaj imię, nazwisko oraz e-mail!");
        return;
    }

    const tableRows = document.querySelectorAll(".final-table tbody tr");
    if (tableRows.length === 0) {
        alert("❌ Brak tabeli do wysłania!");
        return;
    }

    let tableData = [];
    tableRows.forEach(row => {
        let cells = row.querySelectorAll("td");
        if (cells.length > 0) {
            let rowData = `${cells[2].textContent} - ${cells[3].textContent} (${cells[1].textContent})`;
            tableData.push(rowData);
        }
    });

    if (tableData.length === 0) {
        alert("❌ Nie znaleziono danych do wysłania!");
        return;
    }

    console.log("📤 Wysyłane dane:", { name, email, tableData });

    // 🔹 **Wysyłanie danych do backendu**
    try {
        const response = await fetch("/send-pdf", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ name, email, tableData })
        });

        const data = await response.json();
        if (response.ok) {
            alert("✅ PDF został wysłany na e-mail!");
        } else {
            alert("❌ Błąd wysyłania PDF: " + data.message);
        }
    } catch (error) {
        console.error("❌ Błąd połączenia z serwerem:", error);
        alert("❌ Wystąpił problem z połączeniem z serwerem.");
    }
});
</script>
