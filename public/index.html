<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Generator Godzin RmLogistics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Bootstrap CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  />
  <!-- Font Awesome (opcjonalnie, jeśli chcesz ikony) -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />
  <style>
    body {
      background-color: #f9f9f9;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
    }
    .container {
      margin-top: 30px;
      margin-bottom: 30px;
      max-width: 1000px;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .header h1 {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 10px;
      color: #333;
    }
    .header p {
      font-size: 16px;
      color: #555;
    }
    .tab-content {
      margin-top: 20px;
    }
    .final-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    }
    .final-table th,
    .final-table td {
      border: 1px solid #000;
      padding: 8px;
      text-align: center;
      vertical-align: middle;
    }
    .final-table thead th {
      background-color: #e0e0e0;
      font-weight: bold;
    }
    .final-table .holiday td {
      background-color: #ffcccc;
      color: #a00;
      font-weight: bold;
    }
    #exportButtons {
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Nagłówek -->
    <div class="header">
      <h1>
        <span style="color: black;">Rm</span
        ><span style="color: blue;">Logistics</span> – Generator Godzin
      </h1>
      <p>Wprowadź dane i wybierz rodzaj umowy, a następnie wygeneruj i wyślij harmonogram.</p>
      <button
        class="btn btn-outline-dark"
        onclick="window.location.href='/admin'">
        Przejdź do panelu Admina
      </button>
    </div>

    <!-- Zakładki: Instrukcja / Formularz -->
    <ul class="nav nav-tabs" id="tabMenu" role="tablist">
      <li class="nav-item">
        <button
          class="nav-link active"
          id="instrukcja-tab"
          data-bs-toggle="tab"
          data-bs-target="#instrukcja"
          type="button"
          role="tab"
          aria-controls="instrukcja"
          aria-selected="true"
        >
          Instrukcja
        </button>
      </li>
      <li class="nav-item">
        <button
          class="nav-link"
          id="formularz-tab"
          data-bs-toggle="tab"
          data-bs-target="#formularz"
          type="button"
          role="tab"
          aria-controls="formularz"
          aria-selected="false"
        >
          Formularz
        </button>
      </li>
    </ul>

    <div class="tab-content">
      <!-- Instrukcja -->
      <div
        class="tab-pane fade show active"
        id="instrukcja"
        role="tabpanel"
        aria-labelledby="instrukcja-tab"
      >
        <div class="card mt-3">
          <div class="card-body">
            <h5 class="card-title">Jak wypełnić formularz?</h5>
            <p>
              1. Wybierz rodzaj umowy:
              <ul>
                <li><strong>Umowa zlecenie</strong> – godziny generowane losowo, opcja "Losowe dni wolne" jest obowiązkowa.</li>
                <li><strong>Umowa o pracę (pełny etat)</strong> – stałe godziny: 8:00–16:00.</li>
                <li><strong>Umowa o pracę (3/4 etatu)</strong> – stałe godziny: 8:00–14:00 + opcjonalny wniosek urlopowy.</li>
              </ul>
            </p>
            <p>
              2. Dla umowy zlecenie wpisz łączną liczbę godzin. Dla umowy o pracę
              pole to będzie ukryte.
            </p>
            <p>3. Wybierz miesiąc i rok, dodaj (opcjonalnie) ręcznie dni wolne.</p>
            <p>4. Zaznacz opcję "Dodaj losowo dni wolne", jeśli chcesz.</p>
            <p>5. Kliknij "Generuj i wyślij", aby wysłać dokument.</p>
            <p>
              <strong>Uwaga:</strong> Harmonogram zostanie wysłany na adres
              <em>pawel.ruchlicki@emerlog.eu</em>.
            </p>
          </div>
        </div>
      </div>

      <!-- Formularz -->
      <div
        class="tab-pane fade"
        id="formularz"
        role="tabpanel"
        aria-labelledby="formularz-tab"
      >
        <div class="card mt-3">
          <div class="card-body">
            <h5 class="card-title">Formularz danych</h5>
            <form id="generatorForm" novalidate>
              <!-- Rodzaj umowy -->
              <div class="mb-3">
                <label class="form-label">Rodzaj umowy</label>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="contractType"
                    id="contractZlecenie"
                    value="zlecenie"
                    checked
                  />
                  <label class="form-check-label" for="contractZlecenie"
                    >Umowa zlecenie</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="contractType"
                    id="contractPraca"
                    value="praca"
                  />
                  <label class="form-check-label" for="contractPraca"
                    >Umowa o pracę (pełny etat)</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="contractType"
                    id="contract34"
                    value="praca3/4"
                  />
                  <label class="form-check-label" for="contract34"
                    >Umowa o pracę (3/4 etatu)</label
                  >
                </div>
              </div>

              <!-- Checkbox wniosku urlopowego (tylko 3/4) -->
              <div class="mb-3 form-check" id="vacationRequestGroup" style="display:none;">
                <input type="checkbox" class="form-check-input" id="generateVacation" />
                <label class="form-check-label" for="generateVacation"
                  >Wygeneruj wniosek urlopowy</label
                >
              </div>

              <div class="row">
                <!-- Imię i nazwisko -->
                <div class="col-md-6 mb-3">
                  <label class="form-label">Imię i nazwisko</label>
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    required
                  />
                </div>
                <!-- Łączna liczba godzin -->
                <div class="col-md-6 mb-3" id="hoursGroup">
                  <label class="form-label">Łączna liczba godzin</label>
                  <input
                    type="number"
                    class="form-control"
                    id="hours"
                    min="1"
                    required
                  />
                </div>
              </div>

              <div class="row">
                <!-- Miesiąc -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">Miesiąc</label>
                  <select id="month" class="form-select" required>
                    <option value="">Wybierz...</option>
                    <option value="1">Styczeń</option>
                    <option value="2">Luty</option>
                    <option value="3">Marzec</option>
                    <option value="4">Kwiecień</option>
                    <option value="5">Maj</option>
                    <option value="6">Czerwiec</option>
                    <option value="7">Lipiec</option>
                    <option value="8">Sierpień</option>
                    <option value="9">Wrzesień</option>
                    <option value="10">Październik</option>
                    <option value="11">Listopad</option>
                    <option value="12">Grudzień</option>
                  </select>
                </div>
                <!-- Rok -->
                <div class="col-md-4 mb-3">
                  <label class="form-label">Rok</label>
                  <input
                    type="number"
                    class="form-control"
                    id="year"
                    min="1900"
                    value="2025"
                    required
                  />
                </div>
                <div class="col-md-4 mb-3">
                  <small class="form-text"
                    >Praca kończy się zawsze przed 20:00.</small
                  >
                </div>
              </div>

              <!-- Ręcznie dodawane dni wolne -->
              <div class="mb-3">
                <label class="form-label">Dodatkowe dni wolne</label>
                <div class="input-group">
                  <input type="date" class="form-control" id="holidayPicker" />
                  <button type="button" class="btn btn-secondary" id="addHoliday">
                    Dodaj wolne
                  </button>
                </div>
                <ul class="holidays-list" id="holidaysList"></ul>
              </div>

              <!-- Losowe dni wolne -->
              <div class="mb-3 form-check" id="randomHolidaysGroup">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="randomHolidays"
                />
                <label class="form-check-label" for="randomHolidays"
                  >Dodaj losowo dni wolne</label
                >
              </div>

              <button type="submit" class="btn btn-primary w-100 mt-2">
                Generuj i wyślij
              </button>
            </form>
          </div>
        </div>

        <!-- Wyświetlenie wyniku (tabela) + PDF -->
        <div id="output" class="table-responsive mt-3"></div>
        <div id="exportButtons" class="mt-3" style="display:none;">
          <button id="generatePDF" class="btn btn-success">
            Pobierz PDF
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer class="text-center text-muted mb-4">
    &copy; 2023 RmLogistics – Generator Godzin
  </footer>

  <!-- Biblioteki -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // -------------------------------------------------------------------------------------
    // Zmienione: brak pola e-mail w formularzu – zawsze wysyłamy do pawel.ruchlicki@emerlog.eu
    // -------------------------------------------------------------------------------------

    // Miesięczne parametry
    const FIRST_WORKING_DAYS = {};
    const monthlyData2025 = {
      1: { totalHours: 168, workingDays: 21, freeDays: 10 },
      2: { totalHours: 160, workingDays: 20, freeDays: 8 },
      3: { totalHours: 168, workingDays: 21, freeDays: 10 },
      4: { totalHours: 168, workingDays: 21, freeDays: 9 },
      5: { totalHours: 160, workingDays: 20, freeDays: 11 },
      6: { totalHours: 160, workingDays: 20, freeDays: 10 },
      7: { totalHours: 184, workingDays: 23, freeDays: 8 },
      8: { totalHours: 160, workingDays: 20, freeDays: 11 },
      9: { totalHours: 176, workingDays: 22, freeDays: 8 },
      10: { totalHours: 184, workingDays: 23, freeDays: 8 },
      11: { totalHours: 144, workingDays: 18, freeDays: 12 },
      12: { totalHours: 168, workingDays: 21, freeDays: 10 },
    };

    window.customHolidays = [];
    window.randomFreeDaysAdded = [];

    const MAX_HOURS_PER_DAY = 12;
    const MIN_HOURS_PER_DAY = 4;

    // -- Obsługa pokazywania/pola hours i wniosku urlopowego
    document.querySelectorAll('input[name="contractType"]').forEach((input) => {
      input.addEventListener("change", () => {
        const type = document.querySelector(
          'input[name="contractType"]:checked'
        ).value;
        if (type === "praca" || type === "praca3/4") {
          document.getElementById("hoursGroup").style.display = "none";
          document.getElementById("hours").required = false;
          document.getElementById("vacationRequestGroup").style.display =
            type === "praca3/4" ? "block" : "none";

          document.getElementById("randomHolidays").disabled = false;
          document.getElementById("randomHolidays").checked = false;
        } else {
          document.getElementById("hoursGroup").style.display = "block";
          document.getElementById("hours").required = true;
          document.getElementById("vacationRequestGroup").style.display = "none";

          document.getElementById("randomHolidays").checked = true;
          document.getElementById("randomHolidays").disabled = true;
        }
      });
    });

    // Obsługa "Dodatkowych dni wolnych"
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("generatorForm");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        if (!form.checkValidity()) {
          e.stopPropagation();
        } else {
          // Generuj lokalnie tabelę
          generateTable();
          // Wyślij do backendu
          await sendPDF();
        }
        form.classList.add("was-validated");
      });

      document.getElementById("addHoliday").addEventListener("click", () => {
        const selDate = document.getElementById("holidayPicker").value;
        if (!selDate) {
          alert("Wybierz datę!");
          return;
        }
        if (!window.customHolidays.includes(selDate)) {
          window.customHolidays.push(selDate);
          renderHolidays();
        }
      });

      function renderHolidays() {
        const holidaysListEl = document.getElementById("holidaysList");
        holidaysListEl.innerHTML = "";
        window.customHolidays.forEach((h) => {
          const li = document.createElement("li");
          li.textContent = h;
          const btn = document.createElement("button");
          btn.classList.add("btn", "btn-sm", "btn-danger", "ms-2");
          btn.textContent = "Usuń";
          btn.addEventListener("click", () => {
            window.customHolidays = window.customHolidays.filter((x) => x !== h);
            renderHolidays();
          });
          li.appendChild(btn);
          holidaysListEl.appendChild(li);
        });
      }

      // Ustawianie min/max w datePickerze
      const monthEl = document.getElementById("month");
      const yearEl = document.getElementById("year");
      monthEl.addEventListener("change", updateHolidayPickerRange);
      yearEl.addEventListener("change", updateHolidayPickerRange);

      function updateHolidayPickerRange() {
        const mVal = parseInt(monthEl.value, 10);
        const yVal = parseInt(yearEl.value, 10);
        const holidayPicker = document.getElementById("holidayPicker");
        if (!mVal || !yVal) {
          holidayPicker.removeAttribute("min");
          holidayPicker.removeAttribute("max");
          return;
        }
        const daysInMonth = new Date(yVal, mVal, 0).getDate();
        const mm = String(mVal).padStart(2, "0");
        const minDate = `${yVal}-${mm}-01`;
        const maxDate = `${yVal}-${mm}-${daysInMonth}`;
        holidayPicker.setAttribute("min", minDate);
        holidayPicker.setAttribute("max", maxDate);
        if (holidayPicker.value) {
          if (holidayPicker.value < minDate || holidayPicker.value > maxDate) {
            holidayPicker.value = "";
          }
        }
      }
    });

    // Funkcje do generowania tabeli
    const fixedHolidays = [
      "01-01",
      "06-01",
      "20-04",
      "21-04",
      "01-05",
      "03-05",
      "08-06",
      "19-06",
      "15-08",
      "01-11",
      "11-11",
      "25-12",
      "26-12",
    ];

    function isHoliday(day, month, year) {
      const yyyy = String(year).padStart(4, "0");
      const mm = String(month).padStart(2, "0");
      const dd = String(day).padStart(2, "0");
      const fullDate = `${yyyy}-${mm}-${dd}`;
      const shortDate = `${dd}-${mm}`;
      if (window.customHolidays.includes(fullDate)) return true;
      if (fixedHolidays.includes(shortDate)) return true;
      return false;
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function distributeHours(totalHours, daysCount) {
      if (daysCount === 0) return null;
      const maxPossible = MAX_HOURS_PER_DAY * daysCount;
      const minPossible = MIN_HOURS_PER_DAY * daysCount;
      if (totalHours > maxPossible) {
        alert(`Za dużo godzin (max ${maxPossible})!`);
        return null;
      }
      if (totalHours < minPossible) {
        alert(`Za mało godzin (min ${minPossible})!`);
        return null;
      }
      let arr = new Array(daysCount).fill(MIN_HOURS_PER_DAY);
      let leftover = totalHours - daysCount * MIN_HOURS_PER_DAY;
      let base = Math.floor(leftover / daysCount);
      let rem = leftover % daysCount;

      for (let i = 0; i < daysCount; i++) {
        arr[i] += base;
      }
      let idxs = [...Array(daysCount).keys()];
      shuffleArray(idxs);
      for (let i = 0; i < rem; i++) {
        for (let j = 0; j < daysCount; j++) {
          if (arr[idxs[j]] < MAX_HOURS_PER_DAY) {
            arr[idxs[j]]++;
            break;
          }
        }
      }
      // Korekty
      let adjustments = Math.min(Math.ceil(daysCount * 0.3), 8);
      for (let k = 0; k < adjustments; k++) {
        let dayIndex = Math.floor(Math.random() * daysCount);
        let sign = Math.random() < 0.5 ? -1 : 1;
        let newVal = arr[dayIndex] + sign;
        if (newVal >= MIN_HOURS_PER_DAY && newVal <= MAX_HOURS_PER_DAY) {
          arr[dayIndex] = newVal;
        }
      }
      let diff = totalHours - arr.reduce((a, b) => a + b, 0);
      if (diff !== 0) {
        for (let i = 0; i < daysCount && diff !== 0; i++) {
          if (diff > 0 && arr[i] < MAX_HOURS_PER_DAY) {
            let canAdd = Math.min(diff, MAX_HOURS_PER_DAY - arr[i]);
            arr[i] += canAdd;
            diff -= canAdd;
          } else if (diff < 0 && arr[i] > MIN_HOURS_PER_DAY) {
            let canRem = Math.min(Math.abs(diff), arr[i] - MIN_HOURS_PER_DAY);
            arr[i] -= canRem;
            diff += canRem;
          }
        }
      }
      let finalSum = arr.reduce((a, b) => a + b, 0);
      if (finalSum !== totalHours) {
        alert("Nie udało się dopasować godzin do wskazanej sumy.");
        return null;
      }
      return arr;
    }

    function getRandomInt(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      if (max < min) return min;
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function formatDate(date) {
      const d = String(date.getDate()).padStart(2, "0");
      const m = String(date.getMonth() + 1).padStart(2, "0");
      const y = date.getFullYear();
      return `${d}.${m}.${y}`;
    }

    function groupDates(dates) {
      if (!dates.length) return [];
      let groups = [];
      let groupStart = dates[0];
      let groupEnd = dates[0];
      for (let i = 1; i < dates.length; i++) {
        let current = dates[i];
        if (current - groupEnd === 86400000) {
          groupEnd = current;
        } else {
          groups.push({ start: groupStart, end: groupEnd });
          groupStart = current;
          groupEnd = current;
        }
      }
      groups.push({ start: groupStart, end: groupEnd });
      return groups;
    }

    function generateTable() {
      window.randomFreeDaysAdded = [];
      const fullName = document.getElementById("name").value.trim();
      const contractType = document.querySelector(
        'input[name="contractType"]:checked'
      ).value;
      const monthVal = parseInt(document.getElementById("month").value, 10);
      const yearVal = parseInt(document.getElementById("year").value, 10);
      const addRandom = document.getElementById("randomHolidays").checked;
      const generateVacation = document.getElementById("generateVacation").checked;

      if (!fullName || !monthVal || !yearVal) {
        alert("Proszę wypełnić wszystkie wymagane pola!");
        return;
      }

      let totalHours = 0;
      if (contractType === "zlecenie") {
        totalHours = parseInt(document.getElementById("hours").value, 10);
      }

      const daysInMonth = new Date(yearVal, monthVal, 0).getDate();
      let dayData = [];
      for (let d = 1; d <= daysInMonth; d++) {
        const dateObj = new Date(yearVal, monthVal - 1, d);
        const isWeekend = [0, 6].includes(dateObj.getDay());
        const holiday = isHoliday(d, monthVal, yearVal);
        dayData.push({
          day: d,
          date: dateObj,
          isWorkingDay: !isWeekend && !holiday,
          hours: 0,
          start: "-",
          end: "-",
          randomHoliday: false,
        });
      }

      // Losowe dni wolne (zlec.)
      if (contractType === "zlecenie" && addRandom) {
        const freeDaysPattern = [0, 1, 3, 1, 0, 0];
        let grouped = {};
        dayData.forEach((day) => {
          const week = Math.floor((day.day - 1) / 7) + 1;
          if (!grouped[week]) grouped[week] = [];
          grouped[week].push(day);
        });
        Object.keys(grouped).forEach((weekKey) => {
          const weekDays = grouped[weekKey];
          const workingInWeek = weekDays.filter((d) => d.isWorkingDay);
          let required = freeDaysPattern[parseInt(weekKey) - 1] || 0;
          required = Math.min(required, workingInWeek.length);
          if (required > 0) {
            const shuffled = workingInWeek.sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, required);
            selected.forEach((day) => {
              day.isWorkingDay = false;
              day.hours = 0;
              day.start = "-";
              day.end = "-";
              day.randomHoliday = true;
              window.randomFreeDaysAdded.push(day);
            });
          }
        });
      }

      let workingDays = dayData.filter((d) => d.isWorkingDay);

      if (contractType === "praca") {
        // 8h
        workingDays.forEach((day) => {
          day.hours = 8;
          day.start = "8:00";
          day.end = "16:00";
        });
      } else if (contractType === "praca3/4") {
        // 6h
        workingDays.forEach((day) => {
          day.hours = 6;
          day.start = "8:00";
          day.end = "14:00";
        });
      } else if (contractType === "zlecenie") {
        let hoursArray = distributeHours(totalHours, workingDays.length);
        if (!hoursArray) return;
        for (let i = 0; i < workingDays.length; i++) {
          let wd = workingDays[i];
          let h = hoursArray[i];
          let maxStart = 20 - h;
          let sH = getRandomInt(6, maxStart);
          let eH = sH + h;
          if (eH > 20) {
            alert(`Dzień ${wd.day}: koniec pracy po 20:00!`);
            return;
          }
          wd.hours = h;
          wd.start = sH + ":00";
          wd.end = eH + ":00";
        }
      }

      // Sum
      let finalSum = workingDays.reduce((acc, d) => acc + d.hours, 0);

      // Generowanie HTML
      let tableHTML = createScheduleTable(fullName, monthVal, yearVal, contractType, dayData, finalSum);

      // Wniosek urlopowy (zlec. + randomFreeDays, lub praca3/4 + check)
      if (
        (contractType === "zlecenie" && window.randomFreeDaysAdded.length > 0) ||
        (contractType === "praca3/4" && generateVacation && window.randomFreeDaysAdded.length > 0)
      ) {
        tableHTML += createVacationRequest(fullName, monthVal, yearVal);
      }
      document.getElementById("output").innerHTML = tableHTML;
      document.getElementById("exportButtons").style.display = "block";
      document.getElementById("generatePDF").onclick = downloadPDF;
    }

    function createScheduleTable(fullName, monthVal, yearVal, contractType, dayData, sumOfHours) {
      const monthNames = [
        "Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec",
        "Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"
      ];
      const workingDays = dayData.filter(d => d.hours > 0);
      let rows = dayData.map(d => {
        const dd = String(d.day).padStart(2, "0");
        const mm = String(monthVal).padStart(2, "0");
        const yyyy = yearVal;
        const weekday = d.date.toLocaleString("pl-PL", { weekday: "short" });
        if (d.isWorkingDay && d.hours > 0) {
          return `
            <tr>
              <td>${d.day}</td>
              <td>${dd}.${mm}.${yyyy} (${weekday})</td>
              <td>${d.start}</td>
              <td>${d.end}</td>
              <td>${d.hours}</td>
              <td>${fullName.split(" ").slice(1).join(" ")}</td>
              <td></td>
            </tr>
          `;
        } else {
          // wolne
          return `
            <tr class="holiday">
              <td>${d.day}</td>
              <td>${dd}.${mm}.${yyyy} (${weekday})</td>
              <td>-</td>
              <td>-</td>
              <td>0</td>
              <td>${fullName.split(" ").slice(1).join(" ")}</td>
              <td></td>
            </tr>
          `;
        }
      });
      rows.push(`
        <tr class="fw-bold">
          <td colspan="4">Suma godzin:</td>
          <td>${sumOfHours}</td>
          <td colspan="2"></td>
        </tr>
      `);

      let contractDesc = "";
      if (contractType === "praca") contractDesc = "Umowa o pracę (8:00 - 16:00)";
      else if (contractType === "praca3/4") contractDesc = "Umowa o pracę (3/4 etatu, 8:00 - 14:00)";
      else contractDesc = "Umowa zlecenie (losowe godziny)";

      let tableHTML = `
        <h3 class="mt-4">${monthNames[monthVal - 1]} ${yearVal}</h3>
        <h4>${fullName}</h4>
        <p><strong>Rodzaj umowy: ${contractDesc}</strong></p>
        <table class="final-table">
          <thead>
            <tr>
              <th>Dzień</th>
              <th>Data</th>
              <th>Godz. rozpoczęcia</th>
              <th>Godz. zakończenia</th>
              <th>Suma godzin</th>
              <th>Podpis zleceniobiorcy</th>
              <th>Podpis zleceniodawcy</th>
            </tr>
          </thead>
          <tbody>
            ${rows.join("")}
          </tbody>
        </table>
      `;
      return tableHTML;
    }

    function createVacationRequest(fullName, monthVal, yearVal) {
      // [Dni wolne -> grouping, etc.] – uproszczone
      // generowanie wniosku
      return `
      <div id="vacationRequest" style="display:none; margin: 20px auto; max-width: 600px; font-family: Arial, sans-serif;">
        <h3 style="text-align: center; font-weight: bold; margin-bottom: 20px;">
          WNIOSEK URLOPOWY
        </h3>
        <p><strong>Firma:</strong> RmLogistics Sp. z o.o.</p>
        <p><strong>Imię i nazwisko:</strong> ${fullName}</p>
        <p><strong>Data wystawienia:</strong> ${new Date().toLocaleDateString()}</p>
        <p><strong>Urlop:</strong> Dni wolne zaznaczone w grafiku</p>
        <p style="margin-top: 20px;">Podpis: _______________________</p>
      </div>
      `;
    }

    // Wysyłka do backendu
    async function sendPDF() {
      const name = document.getElementById("name").value.trim();
      let hours = 0;
      const contractType = document.querySelector('input[name="contractType"]:checked').value;
      if (contractType === "zlecenie") {
        hours = parseInt(document.getElementById("hours").value, 10);
      }

      const payload = { name, hours };

      console.log("📩 Wysyłane dane:", payload);

      const response = await fetch("/send-pdf", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const result = await response.json();
      alert(result.message || "Błąd wysyłania PDF!");
    }
  </script>
</body>
</html>
