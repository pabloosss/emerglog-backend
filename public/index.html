<script>
document.getElementById("generatePDF").addEventListener("click", async () => {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();

    if (!name || !email) {
        alert("âŒ Podaj imiÄ™, nazwisko oraz e-mail!");
        return;
    }

    const tableRows = document.querySelectorAll(".final-table tbody tr");
    if (tableRows.length === 0) {
        alert("âŒ Brak tabeli do wysÅ‚ania!");
        return;
    }

    let tableData = [];
    tableRows.forEach(row => {
        let cells = row.querySelectorAll("td");
        if (cells.length > 0) {
            let rowData = `${cells[2].textContent} - ${cells[3].textContent} (${cells[1].textContent})`;
            tableData.push(rowData);
        }
    });

    if (tableData.length === 0) {
        alert("âŒ Nie znaleziono danych do wysÅ‚ania!");
        return;
    }

    console.log("ğŸ“¤ WysyÅ‚ane dane:", { name, email, tableData });

    // ğŸ”¹ **WysyÅ‚anie danych do backendu**
    try {
        const response = await fetch("/send-pdf", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ name, email, tableData })
        });

        const data = await response.json();
        if (response.ok) {
            alert("âœ… PDF zostaÅ‚ wysÅ‚any na e-mail!");
        } else {
            alert("âŒ BÅ‚Ä…d wysyÅ‚ania PDF: " + data.message);
        }
    } catch (error) {
        console.error("âŒ BÅ‚Ä…d poÅ‚Ä…czenia z serwerem:", error);
        alert("âŒ WystÄ…piÅ‚ problem z poÅ‚Ä…czeniem z serwerem.");
    }
});
</script>
